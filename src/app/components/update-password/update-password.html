<div class="update-container">
  <div class="update-card">
    <h3>Security Update Required</h3>
    <p class="text-muted">Your password has expired. Please set a new password to continue.</p>

    <div *ngIf="error" class="alert alert-danger">{{ error }}</div>
    <div *ngIf="success" class="alert alert-success">{{ success }}</div>

    <form (ngSubmit)="onSubmit()" #passwordForm="ngForm">
      
      <div class="form-group">
        <label>Current Password</label>
        <input 
          type="password" 
          [(ngModel)]="oldPassword" 
          name="oldPass" 
          required 
          class="form-control" 
          placeholder="Verify identity"
          #oldPass="ngModel"
          [class.invalid-input]="oldPass.invalid && (oldPass.dirty || oldPass.touched)">
          
        <div *ngIf="oldPass.invalid && (oldPass.dirty || oldPass.touched)" class="text-danger small mt-1">
          Current password is required.
        </div>
      </div>

      <div class="form-group">
        <label>New Password</label>
        <input 
          type="password" 
          [(ngModel)]="newPassword" 
          name="newPass" 
          required 
          minlength="6" 
          class="form-control" 
          placeholder="Min 6 chars"
          #newPass="ngModel"
          [class.invalid-input]="newPass.invalid && (newPass.dirty || newPass.touched)"
          pattern="^(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{6,}$">

        <div *ngIf="newPass.invalid && (newPass.dirty || newPass.touched)" class="text-danger small mt-1">
          <div *ngIf="newPass.errors?.['required']">New password is required.</div>
          <div *ngIf="newPass.errors?.['minlength']">Must be at least 6 characters.</div>
          <div *ngIf="newPass.errors?.['pattern']">
            Must contain 1 Uppercase, 1 Number, and 1 Symbol (@$!%*?&).
          </div>
        </div>
      </div>

      <div class="form-group">
        <label>Confirm Password</label>
        <input 
          type="password" 
          [(ngModel)]="confirmPassword" 
          name="confPass" 
          required 
          class="form-control" 
          placeholder="Re-type new password"
          #confPass="ngModel"
          [class.invalid-input]="confPass.invalid && (confPass.dirty || confPass.touched)">

        <div *ngIf="confPass.invalid && (confPass.dirty || confPass.touched)" class="text-danger small mt-1">
          Confirmation is required.
        </div>
      </div>

      <button type="submit" class="btn btn-danger w-100 mt-3" [disabled]="loading || passwordForm.invalid">
        {{ loading ? 'Updating...' : 'Update Password' }}
      </button>
    </form>
    
    <button (click)="logout()" class="btn btn-link mt-2">Log out</button>
  </div>
</div>