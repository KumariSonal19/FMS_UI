<div class="profile-page-wrapper fade-in">
  <div class="profile-card">
    
    <div class="profile-header">
      <div class="avatar-circle">
        {{ user?.username?.charAt(0) | uppercase }}
      </div>
      <h2 class="user-name">{{ user?.username }}</h2>
      <p class="user-email">{{ user?.email }}</p>
    </div>

    <div class="roles-container">
      @for (role of user?.roles; track role) {
        <span class="role-badge">{{ role }}</span>
      }
    </div>

    @if (showPasswordForm) {
      <div class="password-section fade-in">
        
        <div *ngIf="message" class="alert-success">
          <i class="bi bi-check-circle-fill me-2"></i> {{ message }}
        </div>
        
        <div *ngIf="errorMessage" class="alert-error">
          <i class="bi bi-exclamation-triangle-fill me-2"></i> {{ errorMessage }}
        </div>

        <form (ngSubmit)="onChangePassword()" class="password-form" #passForm="ngForm">
          
          <div class="form-group">
            <label class="form-label">Current Password</label>
            <input type="password" 
                   [(ngModel)]="passwordData.currentPassword" 
                   name="currentPass" 
                   placeholder="Enter your old password" 
                   class="form-input" 
                   required
                   #currPass="ngModel"
                   [class.invalid-input]="currPass.invalid && (currPass.dirty || currPass.touched)">
            
            <div *ngIf="currPass.invalid && (currPass.dirty || currPass.touched)" class="text-danger small mt-1">
              Current password is required.
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">New Password</label>
            <input type="password" 
                   [(ngModel)]="passwordData.newPassword" 
                   name="newPass" 
                   placeholder="Enter new password (min 6 chars)" 
                   class="form-input" 
                   required 
                   minlength="6"
                   pattern="^(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{6,}$"
                   #newPass="ngModel"
                   [class.invalid-input]="newPass.invalid && (newPass.dirty || newPass.touched)">

            <div *ngIf="newPass.invalid && (newPass.dirty || newPass.touched)" class="text-danger small mt-1">
              <div *ngIf="newPass.errors?.['required']">New password is required.</div>
              <div *ngIf="newPass.errors?.['minlength']">Must be at least 6 characters.</div>
              <div *ngIf="newPass.errors?.['pattern']">
                Must contain 1 Uppercase, 1 Number, and 1 Symbol (@$!%*?&).
              </div>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Confirm New Password</label>
            <input type="password" 
                   [(ngModel)]="passwordData.confirmPassword" 
                   name="confirmPass" 
                   placeholder="Re-enter new password" 
                   class="form-input" 
                   required
                   #confPass="ngModel"
                   [class.invalid-input]="confPass.invalid && (confPass.dirty || confPass.touched)">
            
            <div *ngIf="confPass.invalid && (confPass.dirty || confPass.touched)" class="text-danger small mt-1">
              Confirmation is required.
            </div>
          </div>

          <button type="submit" class="btn-submit-pass" [disabled]="passForm.invalid">
            Update Password
          </button>
        </form>
      </div>
    }
    
    <button class="btn-change-pass mb-4" (click)="togglePasswordForm()">
          {{ showPasswordForm ? 'Cancel' : 'Change Password' }}
    </button>
    
    <div class="card-footer">
      <button class="btn-logout" (click)="logout()">
        Sign Out
      </button>
    </div>

  </div>
</div>